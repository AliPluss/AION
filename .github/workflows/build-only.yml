name: Build Package Only

on:
  release:
    types: [published]
  workflow_dispatch:  # Allow manual triggering

jobs:
  build:
    name: Build Package
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install build dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install build twine
    
    - name: Build package
      run: |
        python -m build
    
    - name: Check package
      run: |
        python -m twine check dist/*
    
    - name: List built packages
      run: |
        echo "ðŸ“¦ Built packages:"
        ls -la dist/
        echo ""
        echo "ðŸŽ¯ Package ready for manual publishing:"
        echo "   twine upload dist/*"
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: python-package-distributions
        path: dist/
        retention-days: 30
    
    - name: Create build summary
      run: |
        echo "## ðŸ“¦ Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "- **Package:** AION AI Operating Node" >> $GITHUB_STEP_SUMMARY
        echo "- **Version:** ${{ github.event.release.tag_name || 'development' }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Build Status:** âœ… Success" >> $GITHUB_STEP_SUMMARY
        echo "- **Artifacts:** Available for download" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸš€ Manual Publishing" >> $GITHUB_STEP_SUMMARY
        echo "Download artifacts and run:" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
        echo "twine upload dist/*" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
